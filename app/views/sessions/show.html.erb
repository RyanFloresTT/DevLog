<div class="container mx-auto px-4 py-8">
  <div class="max-w-3xl mx-auto space-y-8">

    <div>
      <%= render partial: "sessions/session", locals: { session: @session } %>
    </div>

    <div class="flex justify-between items-center bg-white text-lg p-4 rounded-lg shadow">
      <%= link_to project_path(@project),
                  class: "inline-flex items-center text-red-600 hover:underline font-typewriter" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 011.414-1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                clip-rule="evenodd" />
        </svg>
        Back to project
      <% end %>
    </div>

    <!-- Opening Notes Section -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="permanent-marker-regular text-2xl mb-4 text-gray-900">Opening Notes</h2>
      <p class="prose text-gray-700 text-lg font-typewriter"><%= @session.opening_notes %></p>
    </div>

    <!-- Updates Section -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="permanent-marker-regular text-2xl mb-4 text-gray-900">Updates</h2>

      <% if @session.ended_at.nil? %>
        <!-- Add Update Form -->
        <div class="mb-6">
          <h3 class="text-xl mb-4 font-typewriter text-gray-800">Add Update</h3>
          <%= form_with(model: [@project, @session, @session.entries.build]) do |form| %>
            <div>
              <%= form.text_area :response, rows: 3,
                                 placeholder: "What are you working on?",
                                 class: "block w-full p-2 border rounded-md focus:ring focus:ring-blue-500 focus:border-blue-500 font-typewriter" %>
            </div>
            <%= form.submit "Update",
                            class: "mt-4 text-blue-600 hover:text-blue-800 hover:underline font-typewriter" %>
          <% end %>
        </div>
      <% end %>

      <!-- List of Updates -->
      <% if @session.entries.any? %>
        <ul class="space-y-4">
          <% @session.entries.each do |entry| %>
            <li class="bg-gray-100 rounded-lg shadow p-4">
              <p class="text-gray-800 text-lg font-typewriter"><%= entry.response %></p>
              <p class="text-gray-500 text-sm mt-2 font-typewriter">
                Added on
                <%= entry.created_at.try(:strftime, "%B %d, %Y at %I:%M %p") || "Unknown Date" %>
              </p>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="text-gray-700 font-typewriter">No updates yet. Start by adding your first update!</p>
      <% end %>
    </div>

    <!-- Closing or End Session Section -->
    <% if @session.ended_at.nil? %>
      <!-- End Session Form -->
      <div class="bg-gray-50 rounded-lg shadow p-6">
        <h2 class="permanent-marker-regular text-2xl mb-4 text-gray-900">End Session</h2>
        <%= form_with(model: [@project, @session]) do |form| %>
          <div>
            <%= form.text_area :closing_notes, rows: 3,
                               placeholder: "Add closing notes for this session.",
                               class: "block w-full p-2 border rounded-md focus:ring focus:ring-red-500 focus:border-red-500 font-typewriter" %>
          </div>
          <%= form.hidden_field :ended_at, value: Time.current %>
          <%= form.submit "End Session",
                          class: "mt-4 text-red-600 hover:text-red-800 hover:underline font-typewriter" %>
        <% end %>
      </div>
    <% else %>
      <!-- Closing Notes Section -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="permanent-marker-regular text-2xl mb-4 text-gray-900">Closing Notes</h2>
        <p class="prose text-gray-700 text-lg font-typewriter"><%= @session.closing_notes || "No closing notes were provided for this session." %></p>
        <p class="text-gray-500 text-sm mt-2 font-typewriter">Session ended on <%= @session.ended_at.strftime("%B %d, %Y at %I:%M %p") %>.</p>
      </div>
    <% end %>

  </div>
</div>